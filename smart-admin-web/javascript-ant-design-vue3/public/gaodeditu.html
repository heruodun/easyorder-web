<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
        }
    </style>
    <title>规划结果 + 驾车路线绘制</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: "ab4572c62d456fbc4c78d1861e88c7b3",
        };
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=ef07b68f9ba4b5cf14dc3f84e6afdac7&plugin=AMap.Driving"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
</head>
<body>
<div id="container"></div>
<div id="panel"></div>
<script type="text/javascript">
    var map = new AMap.Map("container", {
        center: [120.241519, 30.885556],
        zoom: 14
    });

    var drivingOption = {
        policy: AMap.DrivingPolicy.LEAST_TIME, // 其它policy参数请参考 https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingPolicy
        ferry: 1, // 是否可以使用轮渡
        province: '京', // 车牌省份的汉字缩写
    }

    var locations =
        [
            [
                142,
                1030,
                "小王牛筋",
                120.241519,
                30.885556
            ],
            [
                126,
                516,
                "中华西366-2-6",
                120.249871,
                30.872635
            ],
            [
                115,
                295,
                "中华西188-3-6",
                120.249006,
                30.872279
            ],
            [
                114,
                294,
                "中华西188-2-5",
                120.248968,
                30.87217
            ],
            [
                120,
                358,
                "送商城西555-4-2（店益民218）",
                120.249815,
                30.870449
            ],
            [
                74,
                87,
                "通益588金研-3-29",
                120.249371,
                30.869378
            ],
            [
                128,
                622,
                "商城西588-3-3-16",
                120.248327,
                30.868065
            ],
            [
                55,
                64,
                "锦绣108-1",
                120.255546,
                30.868689
            ],
            [
                87,
                109,
                "珍贝117",
                120.253667,
                30.866301
            ],
            [
                92,
                171,
                "众盛广场1-4-212室",
                120.252825,
                30.862284
            ],
            [
                101,
                215,
                "栖盛159",
                120.2539,
                30.862137
            ],
            [
                91,
                135,
                "栖盛126",
                120.254877,
                30.862166
            ],
            [
                54,
                63,
                "康泰西108强华辅料",
                120.255141,
                30.863219
            ],
            [
                82,
                99,
                "栖盛115",
                120.255973,
                30.8623
            ],
            [
                59,
                68,
                "栖盛109",
                120.255981,
                30.862239
            ],
            [
                10,
                17,
                "彩虹100",
                120.257382,
                30.86128
            ],
            [
                53,
                61,
                "彩虹128",
                120.258039,
                30.861393
            ],
            [
                2,
                8,
                "栖盛1",
                120.25809900000009,
                30.862530999999972
            ],
            [
                38,
                45,
                "益民10",
                120.25945,
                30.863372
            ],
            [
                63,
                72,
                "益民11",
                120.259505,
                30.863381
            ],
            [
                7,
                13,
                "民盛10",
                120.26037,
                30.86094
            ],
            [
                6,
                12,
                "东盛10",
                120.261326,
                30.863299
            ],
            [
                64,
                73,
                "东盛11",
                120.262879,
                30.863076
            ],
            [
                48,
                56,
                "益民105",
                120.262643,
                30.863733
            ],
            [
                136,
                860,
                "送兴盛112（店益民91）",
                120.262643,
                30.863733
            ],
            [
                94,
                189,
                "送益民西91（店益民150）",
                120.262824,
                30.863774
            ],
            [
                51,
                59,
                "东盛107-2",
                120.265136,
                30.863385
            ],
            [
                65,
                74,
                "东盛111",
                120.265384,
                30.863463
            ],
            [
                45,
                53,
                "东盛102",
                120.265734,
                30.863324
            ],
            [
                119,
                304,
                "益民191-1",
                120.265415,
                30.864041
            ],
            [
                28,
                35,
                "中华1001-52-2",
                120.273169,
                30.877597
            ],
            [
                29,
                36,
                "中华1001-53-701目仓",
                120.27321,
                30.877942
            ],
            [
                30,
                37,
                "中华1001-55-6",
                120.273686,
                30.878439
            ],
            [
                23,
                30,
                "中华1001-29-6",
                120.2751696660481,
                30.87736287623377
            ],
            [
                22,
                29,
                "中华1001-29-2",
                120.27519158993762,
                30.8773800856168
            ],
            [
                16,
                23,
                "中华1001-19-4西",
                120.27524082451413,
                30.876673109682027
            ],
            [
                17,
                24,
                "中华1001-19-5",
                120.27521116039274,
                30.876683759161356
            ],
            [
                15,
                22,
                "中华1001-19-2-西",
                120.27522283751743,
                30.876638283206336
            ],
            [
                14,
                21,
                "中华1001-18-302",
                120.27599,
                30.876596
            ],
            [
                33,
                40,
                "中华1001-8-6-1987",
                120.276119,
                30.876177
            ],
            [
                34,
                41,
                "栋梁1001-9-5泡菜",
                120.27543622131604,
                30.875904613515285
            ],
            [
                32,
                39,
                "中华1001-8-4奶酪",
                120.275945,
                30.875872
            ],
            [
                24,
                31,
                "中华1001-3-204",
                120.27604409260297,
                30.875557638576122
            ],
            [
                19,
                26,
                "中华1001-2-502",
                120.27680442065245,
                30.875613006232456
            ],
            [
                13,
                20,
                "中华1001-16-6",
                120.277239,
                30.876745
            ],
            [
                18,
                25,
                "中华1001-21-3",
                120.27672832295713,
                30.87699895552295
            ],
            [
                21,
                28,
                "中华1001-27-3",
                120.276651,
                30.877386
            ],
            [
                20,
                27,
                "中华1001-26-3",
                120.27711151324998,
                30.87746402383949
            ],
            [
                27,
                34,
                "中华1001-36-2",
                120.277121,
                30.878226
            ],
            [
                26,
                33,
                "中华1001-35-1博利无纺",
                120.27748829879697,
                30.878510224274674
            ],
            [
                12,
                19,
                "中华西1001-15-502",
                120.27767188984778,
                30.87699796334388
            ],
            [
                70,
                81,
                "长安1111-10-2电梯4楼",
                120.279567,
                30.871669
            ],
            [
                69,
                80,
                "长安1111-10-1电梯4楼东",
                120.280324,
                30.871376
            ],
            [
                71,
                82,
                "长安1111-2-4东电梯",
                120.281459,
                30.870481
            ],
            [
                76,
                92,
                "送迎春72（店益民113）",
                120.533014,
                30.843529
            ],
            [
                139,
                1012,
                "昌大隔壁家纺",
                120.30313,
                30.845852
            ],
            [
                41,
                49,
                "东尼1018-16-2东",
                120.282894,
                30.855168
            ],
            [
                50,
                58,
                "送东尼1018-1-4东（店安康107）",
                120.282129,
                30.855638
            ],
            [
                99,
                205,
                "送东尼1018-15-502-暮之礼",
                120.28208,
                30.855218
            ],
            [
                40,
                48,
                "东尼1018-15-1北",
                120.282037,
                30.855202
            ],
            [
                98,
                204,
                "东尼1018-5-3东",
                120.280284,
                30.855766
            ],
            [
                43,
                51,
                "东尼1018-9-5",
                120.280284,
                30.854851
            ],
            [
                39,
                47,
                "东尼1018-10-401",
                120.281204,
                30.85482
            ],
            [
                42,
                50,
                "东尼1018-4-2",
                120.281239,
                30.853573
            ],
            [
                49,
                57,
                "送利济东666-5-4-302（店安康105）",
                120.275499,
                30.85119
            ],
            [
                47,
                55,
                "利强东103",
                120.268788,
                30.848964
            ],
            [
                88,
                110,
                "送洪湖15（店庆丰117）",
                120.26774,
                30.845595
            ],
            [
                0,
                6,
                "西湖1",
                120.267149,
                30.84492
            ],
            [
                5,
                11,
                "广盛10",
                120.265495,
                30.844846
            ],
            [
                68,
                79,
                "渤海11",
                120.265821,
                30.858156
            ],
            [
                62,
                71,
                "富盛11",
                120.263447,
                30.860692
            ],
            [
                3,
                9,
                "新光1",
                120.262441,
                30.859205
            ],
            [
                35,
                42,
                "景富10",
                120.263453,
                30.856956
            ],
            [
                61,
                70,
                "景江109",
                120.263467,
                30.856389
            ],
            [
                103,
                219,
                "富康160",
                120.261856,
                30.854556
            ],
            [
                80,
                97,
                "安康115",
                120.26176,
                30.853575
            ],
            [
                86,
                103,
                "富康116",
                120.260603,
                30.854497
            ],
            [
                9,
                16,
                "富康100",
                120.26027,
                30.854479
            ],
            [
                1,
                7,
                "永康5-A",
                120.257799,
                30.853742
            ],
            [
                60,
                69,
                "永佳西109",
                120.255993,
                30.854879
            ],
            [
                130,
                732,
                "永佳西71",
                120.254646,
                30.854992
            ],
            [
                112,
                272,
                "庆丰西18",
                120.256338,
                30.852288
            ],
            [
                89,
                112,
                "织里中118-1",
                120.257129,
                30.851798
            ],
            [
                90,
                134,
                "环湖125",
                120.259295,
                30.852231
            ],
            [
                11,
                18,
                "钱塘江100",
                120.260843,
                30.850746
            ],
            [
                75,
                89,
                "钱塘江112",
                120.261125,
                30.85071
            ],
            [
                37,
                44,
                "送利济中142-A后门5楼（店南湖101",
                120.261609,
                30.849839
            ],
            [
                141,
                1029,
                "织里中393",
                120.25761,
                30.84574
            ],
            [
                129,
                720,
                "富达6-A",
                120.257321,
                30.845818
            ],
            [
                138,
                954,
                "富兴52",
                120.256109,
                30.845049
            ],
            [
                135,
                854,
                "富强9",
                120.256706,
                30.84638
            ],
            [
                4,
                10,
                "利强10",
                120.256642,
                30.846764
            ],
            [
                127,
                582,
                "利强52送利强2-8-2楼外面楼梯",
                120.255885,
                30.846916
            ],
            [
                132,
                740,
                "利强72",
                120.255788,
                30.846612
            ],
            [
                67,
                77,
                "富兴11",
                120.255074,
                30.846477
            ],
            [
                133,
                752,
                "富兴73",
                120.254637,
                30.844803
            ],
            [
                8,
                15,
                "富兴100",
                120.254391,
                30.844834
            ],
            [
                44,
                52,
                "富兴102",
                120.254214,
                30.84485
            ],
            [
                52,
                60,
                "利强108",
                120.254217,
                30.846665
            ],
            [
                121,
                398,
                "钱塘江西25",
                120.255672,
                30.850134
            ],
            [
                137,
                862,
                "钱塘江西91",
                120.253811,
                30.850137
            ],
            [
                81,
                98,
                "安康西115",
                120.252223,
                30.852837
            ],
            [
                46,
                54,
                "安康西102-3楼",
                120.251846,
                30.852553
            ],
            [
                122,
                422,
                "送栋梁553（店安康西286-A）",
                120.244759,
                30.859815
            ],
            [
                36,
                43,
                "红门馆101",
                120.24749682117074,
                30.85438837808303
            ],
            [
                140,
                1022,
                "送安康西518-2-4王佳新",
                120.245881,
                30.852062
            ],
            [
                134,
                840,
                "利安88-3",
                120.246735,
                30.85029
            ],
            [
                116,
                296,
                "利济西188-4",
                120.248159,
                30.8482
            ],
            [
                84,
                101,
                "利济西115-2-3",
                120.249444,
                30.848715
            ],
            [
                131,
                736,
                "送利济西160-5（店安康71）",
                120.251434,
                30.848601
            ],
            [
                111,
                250,
                "送利达98-5楼（店利强17）",
                120.25051,
                30.84722
            ],
            [
                104,
                221,
                "利强160-3-4",
                120.252041,
                30.846181
            ],
            [
                105,
                229,
                "利强162-4-芽星",
                120.250976,
                30.846049
            ],
            [
                118,
                301,
                "送利强101-3（店利强19）",
                120.249817,
                30.846263
            ],
            [
                113,
                293,
                "利强188-2-3楼左办公室",
                120.248061,
                30.845728
            ],
            [
                83,
                100,
                "利强115-2-2",
                120.247785,
                30.845977
            ],
            [
                95,
                197,
                "送利强198-5-1（店永康15）",
                120.24673,
                30.845481
            ],
            [
                79,
                96,
                "盘珠114-5",
                120.245994,
                30.841768
            ],
            [
                125,
                467,
                "送梦华蕾332-1-3（店富强15）",
                120.239977,
                30.843387
            ],
            [
                93,
                186,
                "新财1-5西",
                120.243208,
                30.840016
            ],
            [
                25,
                32,
                "栋梁1001-3-4",
                120.2436936730316,
                30.838333099276294
            ],
            [
                31,
                38,
                "栋梁1001-8-1西",
                120.244642,
                30.837794
            ],
            [
                97,
                202,
                "笛莎15-5东面",
                120.239805,
                30.834576
            ],
            [
                85,
                102,
                "笛莎11-6北-月",
                120.239414,
                30.835181
            ],
            [
                78,
                95,
                "笛莎11-4",
                120.239439,
                30.835232
            ],
            [
                96,
                201,
                "荣创15-4",
                120.230124,
                30.844091
            ],
            [
                102,
                216,
                "联创谷4B4楼",
                120.208275,
                30.856489
            ],
            [
                100,
                209,
                "阿祥1558轻纺城2楼繁华中b27西门",
                120.232826,
                30.859098
            ],
            [
                77,
                94,
                "大河1-13-1A",
                120.23906,
                30.862527
            ],
            [
                106,
                234,
                "创强163-1-2汕头辅料",
                120.237441,
                30.867906
            ],
            [
                117,
                297,
                "创业88-7",
                120.237422,
                30.868572
            ],
            [
                66,
                75,
                "海优服饰2楼（店创业111-2楼板房",
                120.23846,
                30.868545
            ],
            [
                73,
                85,
                "栋梁111-3-5",
                120.243428,
                30.869375
            ],
            [
                72,
                83,
                "送栋梁111-2-4楼（店富康26）",
                120.243428,
                30.869375
            ],
            [
                58,
                67,
                "中华西1088-2A-304",
                120.238179,
                30.870767
            ],
            [
                57,
                66,
                "中华西1088-2B2楼",
                120.238179,
                30.870767
            ],
            [
                56,
                65,
                "中华西1088-1B-302",
                120.238179,
                30.870767
            ],
            [
                110,
                241,
                "秧石166-8-3西",
                120.23894,
                30.873463
            ],
            [
                109,
                240,
                "秧石166-7-6东",
                120.23894,
                30.873463
            ],
            [
                108,
                239,
                "秧石166-5-6西",
                120.23894,
                30.873463
            ],
            [
                107,
                238,
                "秧石166-4-3西",
                120.23894,
                30.873463
            ],
            [
                123,
                427,
                "栋梁北288-3-204",
                120.241458,
                30.88246
            ],
            [
                124,
                429,
                "栋梁288-3-413",
                120.241458,
                30.88246
            ],
        [
            30,
            1030,
            "小王牛筋",
            120.241519,
            30.885556
        ]
    ];


    // 构造路线导航类
    var driving = new AMap.Driving(drivingOption)


    function planAndDrawDrivingRoute() {
        //mark location
        var startMarker = new AMap.Marker({
            position: [120.241519, 30.885556],
            icon: 'https://webapi.amap.com/theme/v1.3/markers/n/start.png',
            map: map});
        startMarker.setLabel({
           offset: new AMap.Pixel(-0, -25),
            content: locations[0][2],
            direction:'center'
        });
        var endMarker;
        for(var k = 1; k < locations.length - 1; k++){
            var marker = new AMap.Marker({
                position: [locations[k][3], locations[k][4]],
                icon: 'https://webapi.amap.com/theme/v1.3/markers/n/end.png',
                map: map});
            marker.setLabel({
                offset: new AMap.Pixel(-0, -25),
                content: locations[k][2],
                direction:'center'
            });

            if(k == locations.length - 2){
                endMarker = marker;
            }
        }


        var routeList = [];
        for (var i = 0; i < locations.length - 1; i++) {

            // 当前位置作为起点
            var startLocation = locations[i];
            // 下一个位置作为终点
            var endLocation = locations[i + 1];
            // 使用 AMap.LngLat 对象实例化起点和终点坐标
            var startPoint = new AMap.LngLat(startLocation[3], startLocation[4]);
            var endPoint = new AMap.LngLat(endLocation[3], endLocation[4]);

            // 调用AMap路线规划API
            driving.search(startPoint, endPoint, function(status, result) {
                if (status === 'complete') {
                    if (result.routes && result.routes.length) {
                        // 这里的 drawRoute 方法代表将驾车路线绘制在地图上，您需要根据自己的业务需求实现它
                        routeList.push(result.routes[0]);
                        if(routeList.length === locations.length - 1){
                            drawRoute(routeList, startMarker, endMarker);
                        }
                        console.log(result.routes[0] + " " + routeList);
                    }
                } else {
                    console.error('获取驾车数据失败：' + result);
                }
            });
        }
    }


    function drawRoute (routeList, startMarker, endMarker) {
        var totalPath = []
        for(let j = 0; j < routeList.length; j++) {
            var path = parseRouteToPath(routeList[j]);
            totalPath.push(path)

            console.log(" path : " + path );
            console.log("path 0 " + path[0]);
        }


        var routeLine = new AMap.Polyline({
            path: totalPath,
            showDir:true,
            isOutline: true,
            outlineColor: '#ffeeee',
            borderWeight: 2,
            strokeWeight: 5,
            strokeOpacity: 0.9,
            strokeColor: '#008cff',
            lineJoin: 'round'
        })
        map.add(routeLine);
        // 调整视野达到最佳显示区域
        map.setFitView([ startMarker, endMarker, routeLine ])
    }

    // 解析DrivingRoute对象，构造成AMap.Polyline的path参数需要的格式
    // DrivingResult对象结构参考文档 https://lbs.amap.com/api/javascript-api/reference/route-search#m_DriveRoute
    function parseRouteToPath(route) {
        var path = []

        for (var i = 0, l = route.steps.length; i < l; i++) {
            var step = route.steps[i]

            for (var j = 0, n = step.path.length; j < n; j++) {
                path.push(step.path[j])
            }
        }

        return path
    }

    planAndDrawDrivingRoute();

    //

</script>
</body>
</html>









